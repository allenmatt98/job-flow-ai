(function(){class f{constructor(e){this.name=e}matches(e){return!1}scan(){throw new Error("scan() must be implemented")}autofill(e){throw new Error("autofill() must be implemented")}getPageText(){return document.body.innerText}}const S={firstName:["first name","firstname","fname","given name"],lastName:["last name","lastname","lname","surname","family name"],email:["email","e-mail"],phone:["phone","mobile","cell","contact number"],linkedin:["linkedin","linked in"],portfolio:["portfolio","website","personal site"],resume:["resume","cv","curriculum vitae"],coverLetter:["cover letter","coverletter"],school:["school","university","college","institution","alma mater"],degree:["degree","qualification","major"],company:["company","organization","employer","work experience"],title:["job title","role","position"],startDate:["start date","from","start"],endDate:["end date","to","end"],location:["location","city","address"],currentRole:["current role","current position"],description:["description","responsibilities","duties","summary","accomplishments"],gender:["gender","sex","how do you identify"],race:["race","ethnicity","latino","hispanic"],veteran:["veteran","active duty","armed forces"],disability:["disability","handicapped","impairment"]},b=s=>{const e=[s.id,s.name,s.getAttribute("aria-label"),s.placeholder].filter(Boolean).map(n=>n.toLowerCase());let o="";if(s.id){const n=document.querySelector(`label[for="${s.id}"]`);n&&(o=n.innerText)}if(!o&&s.getAttribute("aria-labelledby")){const n=s.getAttribute("aria-labelledby"),i=document.getElementById(n);i&&(o=i.innerText)}if(!o){const n=s.closest("label");n&&(o=n.innerText)}const t=o?o.toLowerCase().trim():"";t&&e.push(t);for(const[n,i]of Object.entries(S))if(i.some(r=>e.some(a=>a.includes(r))))return{type:n,label:o||n};return{type:"unknown",label:o}};function E(s){const e=s.split(","),o=e[0].match(/:(.*?);/)[1],t=atob(e[1]);let n=t.length;const i=new Uint8Array(n);for(;n--;)i[n]=t.charCodeAt(n);return new Blob([i],{type:o})}function x(s,e){if(!e||!e.data)return console.warn("Job Flow AI: No resume data found to upload."),!1;try{const o=E(e.data),t=new File([o],e.name,{type:e.type}),n=new DataTransfer;return n.items.add(t),s.files=n.files,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})),s.dispatchEvent(new FocusEvent("focus",{bubbles:!0})),s.dispatchEvent(new FocusEvent("blur",{bubbles:!0})),console.log(`Job Flow AI: Uploaded ${e.name}`),!0}catch(o){return console.error("Job Flow AI: Upload failed",o),!1}}class y extends f{constructor(e="Heuristic"){super(e),this.pageFields=[]}matches(e){return!0}scan(){const e=document.querySelectorAll("input, textarea, select"),o=[];return e.forEach(t=>{const n=t.type==="hidden"||t.style.display==="none"||t.classList.contains("visually-hidden");if(n&&t.type!=="file"&&t.name!=="resume")return;const i=b(t),{type:r,label:a}=i;if(r!=="unknown"||a){o.push({element:t,type:r,label:a||r,currentValue:t.value});try{n||(t.style.border="2px solid #3b82f6")}catch{}}}),this.pageFields=o,o.map(t=>({type:t.label||t.type,tagName:t.element.tagName,standardType:t.type}))}async autofill(e){let o=0;console.log("Starting Heuristic Autofill...");for(const t of this.pageFields)try{if(t.type!=="unknown"&&e.userProfile&&e.userProfile[t.type]){const n=e.userProfile[t.type];await this.fillFieldWithTimeout(t.element,n),o++}else t.type==="resume"&&e.resume&&(console.log("Uploading resume..."),x(t.element,e.resume)&&o++)}catch(n){console.error(`Failed to fill field ${t.label||t.type}:`,n)}return o}async fillFieldWithTimeout(e,o,t=3e3){const n=this.fillField(e,o);let i;const r=new Promise((a,l)=>{i=setTimeout(()=>l(new Error("Operation timed out")),t)});return Promise.race([n,r]).finally(()=>clearTimeout(i))}async fillField(e,o){if(!e||o===void 0||o===null)return;const t=e.tagName.toLowerCase(),n=(e.type||"").toLowerCase(),i=(e.getAttribute("role")||"").toLowerCase();t==="select"?this.fillSelect(e,o):n==="checkbox"?this.fillCheckbox(e,o):n==="radio"?this.fillRadio(e,o):i==="combobox"||e.classList.contains("select__input")?await this.fillCombobox(e,o):this.fillStandardInput(e,o)}fillStandardInput(e,o){e.focus();const t=e.tagName.toLowerCase()==="textarea"?window.HTMLTextAreaElement.prototype:window.HTMLInputElement.prototype;Object.getOwnPropertyDescriptor(t,"value").set.call(e,o),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0}))}async fillCombobox(e,o){e.focus(),e.click(),Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(e,o),e.dispatchEvent(new Event("input",{bubbles:!0})),await new Promise(r=>setTimeout(r,800));const i=Array.from(document.querySelectorAll('[role="option"], .select__option')).find(r=>r.innerText.toLowerCase().includes(String(o).toLowerCase()));i?i.click():e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0}))}fillSelect(e,o){const t=Array.from(e.options),n=String(o).toLowerCase();let i=t.find(r=>r.value.toLowerCase()===n||r.text.toLowerCase()===n);i||(i=t.find(r=>r.text.toLowerCase().includes(n))),i&&(e.value=i.value,e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0})))}fillCheckbox(e,o){const t=o===!0||String(o).toLowerCase()==="true"||String(o).toLowerCase()==="yes";e.checked!==t&&(e.click(),e.checked!==t&&(e.checked=t,e.dispatchEvent(new Event("change",{bubbles:!0}))))}fillRadio(e,o){const t=String(o).toLowerCase();(e.value.toLowerCase()===t||e.nextSibling&&e.nextSibling.textContent&&e.nextSibling.textContent.toLowerCase()===t)&&e.click()}}class T{constructor(){this.synonyms={btech:["bachelor","technology"],be:["bachelor","engineering"],bs:["bachelor","science"],mtech:["master","technology"],ms:["master","science"],phd:["doctor","philosophy"],iit:["indian","institute","technology"],nit:["national","institute","technology"],bits:["birla","institute","technology"],iiit:["indian","institute","information","technology"],cmu:["carnegie","mellon"],mit:["massachusetts","institute","technology"],nyu:["new","york","university"],ucla:["university","california","los","angeles"],bangalore:["bengaluru"],bengaluru:["bangalore"],bom:["mumbai"],bombay:["mumbai"],trichy:["tiruchirappalli"],vizag:["visakhapatnam"],cal:["calcutta","kolkata"],madras:["chennai"],ggn:["gurgaon","gurugram"]},this.stopWords=new Set(["of","the","and","in","at","for","a","an"])}findBestMatch(e,o,t=.6){if(!e||!o||o.length===0)return null;const n=this.tokenizeAndExpand(e);let i=null,r=-1;for(const a of o){const l=this.tokenizeAndExpand(a),u=this.calculateSimilarity(n,l);u>r&&(r=u,i=a)}return console.log(`[SmartMatcher] Query: "${e}" | Best: "${i}" | Score: ${r}`),r>=t?i:null}tokenizeAndExpand(e){const o=e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(n=>n.length>0&&!this.stopWords.has(n)),t=[];for(const n of o)this.synonyms[n]?t.push(...this.synonyms[n]):t.push(n);return new Set(t)}calculateSimilarity(e,o){if(e.size===0||o.size===0)return 0;let t=0;for(const i of e)o.has(i)&&t++;const n=new Set([...e,...o]).size;return t/n}}const p=new T;class v extends y{constructor(){super("Greenhouse")}matches(e){return e.includes("greenhouse.io")}async autofill(e){console.log("Starting Greenhouse Autofill (SmartMatcher Enabled)...");let o=0;try{o+=await super.autofill(e),console.log("Post-Resume Wait (5s) for parsing..."),await new Promise(t=>setTimeout(t,5e3))}catch(t){console.error("Standard autofill failed (non-fatal):",t)}if(e.education&&e.education.length>0)try{console.log("Starting Education Section..."),await this.scrollToSection("education"),o+=await this.fillComplexSection(e.education,"education","school")}catch(t){console.error("Education failed:",t)}if(e.experience&&e.experience.length>0)try{console.log("Starting Employment Section..."),await this.scrollToSection("employment"),o+=await this.fillComplexSection(e.experience,"employment","company")}catch(t){console.error("Employment failed:",t)}try{console.log("Starting Demographics..."),await this.scrollToSection("demographic"),o+=await this.fillDemographics(e.userProfile)}catch(t){console.error("Demographics failed:",t)}return o}async scrollToSection(e){const t=Array.from(document.querySelectorAll("h1, h2, h3, h4, div.heading, .section-header")).find(n=>n.innerText.toLowerCase().includes(e));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(n=>setTimeout(n,500)))}async fillComplexSection(e,o,t){let n=0;for(let i=0;i<e.length;i++){const r=e[i];let a=this.findFieldsByType(t);if(i>=a.length){console.log(`[Greenhouse] Adding row for ${o} (index ${i})`);const u=Array.from(document.querySelectorAll("a, button")).find(d=>{const m=d.innerText.toLowerCase();return(m.includes(`add another ${o}`)||m.includes(`add ${o}`))&&d.offsetParent!==null});u&&(u.click(),await new Promise(d=>setTimeout(d,1500)),a=this.findFieldsByType(t))}if(o==="education")n+=await this.fillSmartInput(i,"school",r.school),n+=await this.fillSmartDropdown(i,"degree",r.degree),n+=await this.fillAtIndex(i,"startDate",{month:"",year:r.start}),n+=await this.fillAtIndex(i,"endDate",{month:"",year:r.end});else if(o==="employment"){n+=await this.fillSmartInput(i,"company",r.company),n+=await this.fillSmartInput(i,"title",r.title),n+=await this.fillAtIndex(i,"description",r.description);const l=this.parseDate(r.start),u=this.parseDate(r.end);n+=await this.fillAtIndex(i,"startDate",l),n+=await this.fillAtIndex(i,"endDate",u)}}return n}async fillSmartInput(e,o,t){if(!t)return 0;const i=this.findFieldsByType(o).filter(r=>r.type!=="hidden")[e];return i?(i.scrollIntoView({behavior:"smooth",block:"center"}),i.getAttribute("role")==="combobox"||i.className.includes("select")||i.className.includes("chosen")?await this.fillComboboxLike(i,t):(await this.fillFieldWithTimeout(i,t),1)):0}async fillSmartDropdown(e,o,t){if(!t)return 0;const i=this.findFieldsByType(o).filter(r=>r.type!=="hidden")[e];if(i){i.scrollIntoView({behavior:"smooth",block:"center"});let r=[];if(i.tagName.toLowerCase()==="select"&&(r=Array.from(i.options).map(a=>a.text)),r.length>0){const a=p.findBestMatch(t,r);if(console.log(`[SmartDropdown] '${t}' -> Best Match: '${a}'`),a)return await this.fillFieldWithTimeout(i,a),1}return await this.fillComboboxLike(i,t)}return 0}async fillComboboxLike(e,o){try{e.focus(),e.click();const t=window.HTMLInputElement.prototype;Object.getOwnPropertyDescriptor(t,"value").set.call(e,o),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),await new Promise(a=>setTimeout(a,800));const i=Array.from(document.querySelectorAll('.select2-results__option, .select__option, [role="option"]')),r=i.map(a=>a.innerText);if(r.length>0){const a=p.findBestMatch(o,r);if(a){const l=i.find(u=>u.innerText===a);if(l)return l.click(),1}}return e.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,keyCode:13})),e.dispatchEvent(new KeyboardEvent("keypress",{key:"Enter",bubbles:!0,keyCode:13})),e.dispatchEvent(new KeyboardEvent("keyup",{key:"Enter",bubbles:!0,keyCode:13})),e.blur(),1}catch(t){return console.warn("Combobox fill failed",t),0}}async fillAtIndex(e,o,t){if(!t)return 0;const n=this.findFieldsByType(o).filter(i=>i.type!=="hidden");if(o==="startDate"||o==="endDate"){const i=n.filter(l=>this.getLabelText(l).includes("month")),r=n.filter(l=>this.getLabelText(l).includes("year"));let a=0;return i[e]&&t.month&&(await this.fillFieldWithTimeout(i[e],t.month),a++),r[e]&&t.year&&(await this.fillFieldWithTimeout(r[e],t.year),a++),a}return n[e]?(await this.fillFieldWithTimeout(n[e],t),1):0}async fillDemographics(e){let o=0;const t=["gender","race","veteran","disability"];for(const n of t)if(e[n]){const i=this.findFieldsByType(n);i[0]&&(await this.fillFieldWithTimeout(i[0],e[n]),o++)}return o}findFieldsByType(e){return Array.from(document.querySelectorAll("input, select, textarea")).filter(o=>o.type==="hidden"||o.style.display==="none"?!1:b(o).type===e)}getLabelText(e){let o="";if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);t&&(o=t.innerText)}if(!o&&e.getAttribute("aria-label")&&(o=e.getAttribute("aria-label")),!o){const t=e.closest("label");t&&(o=t.innerText)}return o?o.toLowerCase():""}parseDate(e){if(!e)return{month:"",year:""};const o=e.split("-");return{year:o[0],month:o[1]}}}class k extends f{constructor(){super("GoogleForms"),this.pageFields=[]}matches(e){return e.includes("docs.google.com")&&window.location.pathname.includes("/forms/")}scan(){const e=document.querySelectorAll('input:not([type="hidden"]), textarea'),o=[];return e.forEach(t=>{const n=t.closest('[role="listitem"]')||t.closest(".geS5n");let i="";if(n){const l=n.querySelector('[role="heading"]');l&&(i=l.innerText)}else i=t.getAttribute("aria-label")||"";let r="unknown";const a=i.toLowerCase();a.includes("email")?r="email":a.includes("name")?r="firstName":a.includes("phone")&&(r="phone"),r!=="unknown"&&(o.push({element:t,type:r,currentValue:t.value}),t.style.border="2px dashed #f59e0b")}),this.pageFields=o,o.map(t=>({type:t.type,tagName:"google-input"}))}autofill(e){let o=0;return this.pageFields.forEach(t=>{if(e[t.type]){const n=e[t.type];t.element.value=n,t.element.dispatchEvent(new Event("input",{bubbles:!0})),t.element.dispatchEvent(new Event("change",{bubbles:!0})),t.element.dispatchEvent(new FocusEvent("focus",{bubbles:!0})),t.element.dispatchEvent(new FocusEvent("blur",{bubbles:!0})),o++}}),o}}function g(s){let e=[];if(!s)return e;const o=s.querySelectorAll("input, textarea, select");e=[...e,...Array.from(o)];const t=s.querySelectorAll("*");for(const n of t)n.shadowRoot&&(e=[...e,...g(n.shadowRoot)]);return e}function w(s){let e="";if(!s)return e;const o=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let t=o.nextNode();for(;t;)t.nodeType===Node.TEXT_NODE?e+=t.textContent+" ":t.shadowRoot&&(e+=w(t.shadowRoot)+" "),t=o.nextNode();return e.replace(/\s+/g," ")}class F extends f{constructor(){super("SmartRecruiters"),this.pageFields=[]}matches(e){return e.includes("smartrecruiters.com")}scan(){const e=g(document.body),o=[];return e.forEach(t=>{if(t.type==="hidden"||t.style.display==="none")return;const n=b(t);if(n!=="unknown"){o.push({element:t,type:n,currentValue:t.value});try{t.style.border="2px solid #8b5cf6"}catch{}}}),this.pageFields=o,o.map(t=>({type:t.type,tagName:t.element.tagName}))}autofill(e){let o=0;return this.pageFields.forEach(t=>{if(e.userProfile&&e.userProfile[t.type]){const n=e.userProfile[t.type];t.element.value=n,t.element.dispatchEvent(new Event("input",{bubbles:!0})),t.element.dispatchEvent(new Event("change",{bubbles:!0})),o++}else t.type==="resume"&&e.resume}),o}getPageText(){return w(document.body).substring(0,15e3)}}class A{constructor(){this.strategies=[new v,new k,new F],this.heuristicStrategy=new y}getStrategy(){const e=window.location.hostname;for(const o of this.strategies)if(o.matches(e))return console.log(`[Job Flow AI] Selected strategy: ${o.name}`),o;return console.log("[Job Flow AI] Selected strategy: Heuristic (Fallback)"),this.heuristicStrategy}}console.log("AI Job Filler Content Script Active");const h=new A;let c=null;const C=()=>(c=h.getStrategy(),console.log("Scanning with:",c.name),c.scan()),L=s=>(c||(c=h.getStrategy()),c.autofill(s));chrome.runtime.onMessage.addListener((s,e,o)=>{try{if(s.action==="SCAN_PAGE"){const t=C();o({count:t.length,fields:t})}else if(s.action==="AUTOFILL"){const t=L(s.profile);o({success:!0,count:t})}else if(s.action==="GET_PAGE_TEXT"){c||(c=h.getStrategy());const t=c.getPageText();o({text:t})}}catch(t){console.error("Job Flow AI Error:",t),o({error:t.message})}return!0});c=h.getStrategy();
})()